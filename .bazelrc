common --enable_platform_specific_config

# Shared configuration flags to build and test Bazel on RBE.
build:remote_shared --define=EXECUTOR=remote
build:remote_shared --remote_instance_name=projects/bazel-untrusted/instances/default_instance
build:remote_shared --remote_executor=grpcs://remotebuildexecution.googleapis.com
build:remote_shared --remote_timeout=600
build:remote_shared --google_default_credentials
build:remote_shared --jobs=100
build:remote_shared --action_env=PATH=/bin:/usr/bin:/usr/local/bin
build:remote_shared --disk_cache=
build:remote_shared --java_runtime_version=rbe_jdk
build:remote_shared --tool_java_runtime_version=rbe_jdk
# Workaround for singlejar incompatibility with RBE
build:remote_shared --noexperimental_check_desugar_deps

# Configuration to build and test Bazel on RBE on Ubuntu 18.04 with Java 11
build:ubuntu1804_java11 --extra_toolchains=@rbe_ubuntu1804_java11//java:all
build:ubuntu1804_java11 --crosstool_top=@rbe_ubuntu1804_java11//cc:toolchain
build:ubuntu1804_java11 --extra_toolchains=@rbe_ubuntu1804_java11//config:cc-toolchain
build:ubuntu1804_java11 --extra_execution_platforms=//:rbe_ubuntu1804_java11_platform
build:ubuntu1804_java11 --extra_execution_platforms=//:rbe_ubuntu1804_java11_highcpu_platform
build:ubuntu1804_java11 --host_platform=//:rbe_ubuntu1804_java11_platform
build:ubuntu1804_java11 --platforms=//:rbe_ubuntu1804_java11_platform
build:ubuntu1804_java11 --config=remote_shared

# Configuration to build and test Bazel on RBE on Ubuntu 16.04 with Java 8
build:ubuntu1604_java8 --extra_toolchains=@rbe_ubuntu1604_java8//java:all
build:ubuntu1604_java8 --crosstool_top=@rbe_ubuntu1604_java8//cc:toolchain
build:ubuntu1604_java8 --extra_toolchains=@rbe_ubuntu1604_java8//config:cc-toolchain
build:ubuntu1604_java8 --extra_execution_platforms=//:rbe_ubuntu1604_java8_platform
build:ubuntu1604_java8 --extra_execution_platforms=//:rbe_ubuntu1604_java8_highcpu_platform
build:ubuntu1604_java8 --host_platform=//:rbe_ubuntu1604_java8_platform
build:ubuntu1604_java8 --platforms=//:rbe_ubuntu1604_java8_platform
build:ubuntu1604_java8 --config=remote_shared

#TODO(ilist): remove once Bazel version on RBE is > 4.0.0
build:ubuntu1804_java11 --host_javabase=@rbe_ubuntu1804_java11//java:jdk
build:ubuntu1804_java11 --javabase=@rbe_ubuntu1804_java11//java:jdk
build:ubuntu1804_java11 --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_java9
build:ubuntu1804_java11 --java_toolchain=@bazel_tools//tools/jdk:toolchain_java9
build:ubuntu1604_java8 --host_javabase=@rbe_ubuntu1604_java8//java:jdk
build:ubuntu1604_java8 --javabase=@rbe_ubuntu1604_java8//java:jdk
build:ubuntu1604_java8 --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
build:ubuntu1604_java8 --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8

build:engflow --jobs=50
build:engflow --define=EXECUTOR=remote
build:engflow --disk_cache=
build:engflow --experimental_inmemory_dotd_files
build:engflow --experimental_inmemory_jdeps_files
build:engflow --incompatible_strict_action_env=true
build:engflow --remote_timeout=3600
build:engflow --spawn_strategy=remote,local

build:engflow --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
build:engflow --crosstool_top=@engflow_remote_config//cc:toolchain
build:engflow --extra_execution_platforms=@engflow_remote_config//config:platform
build:engflow --extra_toolchains=@engflow_remote_config//config:cc-toolchain
build:engflow --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_java11
build:engflow --host_javabase=@engflow_remote_config//java:jdk
build:engflow --host_platform=@engflow_remote_config//config:platform
build:engflow --java_toolchain=@bazel_tools//tools/jdk:toolchain_java11
build:engflow --javabase=@engflow_remote_config//java:jdk
build:engflow --platforms=@engflow_remote_config//config:platform

build:engflow_linux --config=engflow
build:engflow_linux --cpu=k8 --host_cpu=k8

# Alias
build:remote --config=ubuntu1604_java8

build:macos --macos_minimum_os=10.10

# User-specific .bazelrc
try-import user.bazelrc
